<div class="aw-tzlb-px-f" data-total="<?php echo $this->total;?>">
    <?php foreach($this->article_list as $key=>$val) { ?>
    <div class="aw-qanda-div aw-lineq" >
        <p class="aw-q-div-t">
            <a href="article/<?php echo $val['id'];?>"><?php echo $val['title'];?></a>
            <?php  if($val['set_top']==1 && $_GET['sort_type']=='new'){?>
            <span class="aw-set-top"><?php _e('顶');?></span>
            <?php }?>
        </p>
        <div class="aw-q-div-c clearfix">
            <p>
                <?php echo cjk_substr(strip_tags(htmlspecialchars_decode($val['message'])),0,80);?>
            </p>
        </div>
        <?php if($val['img_list']) { ?>
        <div class="aw-x-h-b clearfix aw-preview-img <?php if(count($val['img_list']) >1){ ?>aw-more-image<?php }else{?>aw-one-image<?php } ?>">
            <?php if(count($val['img_list']) >1){ ?>
            <?php foreach($val['img_list'] as $k=>$v) { ?>
            <?php if($k<3) { ?>
            <img src="<?php echo $v;?>" class="more-img">
            <?php } ?>
            <?php } ?>
            <?php }else{?>
            <img src="<?php echo $val['img_list'][0];?>" class="one-img">
            <?php } ?>
        </div>
        <?php } ?>
        <div class="aw-q-div-b clearfix">
            <a class="aw-dz"><i class="icon icon-agree"></i> <?php _e('赞');?><?php echo $val['votes'] ? $val['votes'] : '';?></a>
            <a class="aw-hd"><i class="icon icon-comment"></i> <?php _e('评论');?><?php echo $val['comments'] ? $val['comments'] : '';?></a>
            <a class="aw-hd"><i class="iconfont iconshijian"></i> <?php echo date_friendly($val['add_time']);?></a>
            <a class="aw-more" href="people/<?php echo $val['user_info']['uid'];?>"><img src="<?php echo get_avatar_url($val['user_info']['uid']);?>"></a>
        </div>
    </div>
    <?php } ?>
</div>
<script>
    //图片尺寸判断与处理
    function cutImg(obj){
        var image=new Image();
        image.src=obj.src;
        $this=$(obj);
        var iwidth=$this.width();
        var iheight=$this.height();
        console.log(image.width/image.height);
        console.log(iwidth/iheight);
        if(1*image.width*iheight!=1*iwidth*image.height){
            //原始图片的尺寸与CSS里固定的图片尺寸比例不一致，则进行处理
            if(image.width/image.height>=iwidth/iheight){
                $this.height(iheight+'px');
                $this.width((image.width*iheight)/image.height+'px');
            }else{
                $this.width(iwidth+'px');
                $this.height((image.height*iwidth)/image.width+'px');
            }
            //用cite装起来，做出裁剪效果
            if(!$this.parent().is('cite'))
            {
                $this.wrap('<cite />');
            }
        }
    }

    $('.aw-x-h-b .one-img').each(function(){
        var image=new Image();
        image.src=this.src;
        if(image.complete){
            cutImg(this);
        } else{
            this.onload=function(){
                cutImg(this);
            };
        }
    });

    $('.aw-x-h-b .more-img').each(function(){
        var image=new Image();
        image.src=this.src;
        if(image.complete){
            //存在缓存中，立即处理
            cutImg(this);
        } else{
            //不存在缓存中，onload处理
            this.onload=function(){
                cutImg(this);
            };
        }
    });
</script>