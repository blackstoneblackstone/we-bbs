<?php TPL::output('m/global/header.tpl.htm'); ?>
<style>
	.common-btn{
		width: 70%;
		height: 36px;
		line-height: 36px;
		margin: 15px auto;
		border: 1px solid #499ef3;
		background: #fff;
		display: block;
		border-radius: 10px;
		text-align: center;
	}
</style>
<div class="aw-top">
	<div class="aw-top-divl">
		<a href="<?php echo base_url();?>">
			<i class="iconfont iconshouye" style="color: #999"></i>
		</a>
	</div>
	<span><?php _e('微信授权登录');?></span>
	<div class="aw-top-div">
		<a href="m/account/register/" class="aw-selectLabel-tr"><?php _e('注册');?></a>
	</div>
</div>
<!-- 内容 -->
<div class="aw-sy aw-padding">
	<div class="aw-site-logo">
		<a href="<?php echo base_url();?>"><img src="<?php echo get_setting('login_logo_url') ? get_setting('login_logo_url') : G_STATIC_URL.'/css/'.$this->template_name.'/img/login_logo.png';?>"></a>
	</div>
	<div class="aw-login-box">
		<div class="bind-form">
			<form id="login_form" method="post" onsubmit="return false;" action="account/ajax/login_process/">
				<input type="hidden" name="return_url" value="<?php echo get_js_url('/m/weixin/binding/redirect-' . urlencode($_GET['redirect'])); ?>" />
				<ul>
					<li>
						<input type="text" class="form-control" id="user_name" name="user_name" placeholder="<?php _e('邮箱'); ?>/<?php _e('用户名'); ?>" />
					</li>
					<li>
						<input type="password" class="form-control" id="password" name="password" placeholder="<?php _e('密码'); ?>" onkeydown="if (event.keyCode == 13) { ajax_post($('#login_form')); }" />
					</li>
					<li>
						<a class="common-btn" onclick="$('.bind-form').find('#password').val(encrypt_pass($('.bind-form').find('#password').val()));AWS.ajax_post($('#login_form'));"><?php _e('绑定微信'); ?></a>
					</li>
					<?php if ($this->register_url) { ?>
					<li>
						<p class="text-center color-999"><?php _e('或者点击下面的按钮生成帐号'); ?></p>
						<a href="javascript:;" url="<?php echo $this->register_url; ?>" class="common-btn create_account"><?php _e('生成帐号')?></a>
					</li>
					<li>
						<p class="text-center color-999"><?php _e('如果您还未注册, 请先注册问答账号'); ?></p>
						<a class="common-btn" onclick="$('.bind-confirm, .bind-form').hide();$('.register-confirm, .register-form').show();"><?php _e('注册')?></a>
					</li>
					<?php } ?>
				</ul>
			</form>
		</div>
		<div class="register-form" style="display: none">
			<p class="text-center color-999"><?php _e('请填写下列表单完成账号注册'); ?></p>
			<form id="register_form" method="post" onsubmit="return false;" action="account/ajax/register_process/">
				<input type="hidden" name="agreement_chk" value="agree" />
				<input type="hidden" name="return_url" value="<?php echo get_js_url('/m/weixin/binding/redirect-' . urlencode($_GET['redirect'])); ?>" />
				<ul>
					<li>
						<input type="text" class="form-control" id="user_name" name="user_name" placeholder="<?php _e('用户名'); ?>" value="<?php echo $this->access_user['nickname']; ?>" />
					</li>
					<li>
						<input type="text" class="form-control" id="email" name="email" placeholder="<?php _e('邮箱'); ?>" />
					</li>
					<li>
						<input type="password" class="form-control" id="password" name="password" placeholder="<?php _e('密码'); ?>" onkeydown="if (event.keyCode == 13) { ajax_post($('#register_form')); }" />
					</li>
					<li>
						<a class="common-btn" onclick="AWS.ajax_post($('#register_form')); return false;"><?php _e('注册')?></a>
					</li>
					<?php if ($this->register_url) { ?>
					<li>
						<p class="text-center color-999"><?php _e('或者点击下面的按钮生成帐号'); ?></p>
						<a href="javascript:;" url="<?php echo $this->register_url; ?>" class="common-btn create_account"><?php _e('生成帐号')?></a>
					</li>
					<?php } ?>
					<li>
						<p class="text-center color-999"><?php _e('已有账号'); ?></p>
						<a class="common-btn" onclick="$('.register-confirm, .register-form').hide();$('.bind-confirm, .bind-form').show();"><?php _e('绑定微信'); ?></a>
					</li>
				</ul>
			</form>
		</div>
	</div>
</div>

<!-- DO NOT REMOVE -->
<div id="aw-ajax-box" class="aw-ajax-box"></div>
<div style="display:none">
	<?php echo get_setting('statistic_code'); ?>
</div>
<!-- / DO NOT REMOVE -->
</body>
<script type="text/javascript">
	var url=$(".create_account").attr('url');
	$(".create_account").click(function(){
		var loadingIndex = layer.load(2, { //icon支持传入0-2
			shade: [0.5, 'gray'], //0.5透明度的灰色背景
			content: '生成登录中',
			success: function (layero) {
				layero.find('.layui-layer-content').css({
					'padding-top': '39px',
					'width': '100%'
				});
				$('.layui-layer-loading2').css('background-position','center');
				$(".create_account").attr("disabled",true);
				window.location.href=url;
			}
		});
	});
</script>
</html>