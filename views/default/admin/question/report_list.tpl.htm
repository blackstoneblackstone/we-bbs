<?php TPL::output('admin/global/header.tpl.htm'); ?>
<?php TPL::output('admin/global/nav_menu.tpl.htm'); ?>

<div class="aw-content-wrap">
    <div class="mod">
        <div class="mod-head">
            <h3>
				<ul class="nav nav-tabs">
					<li class="<?php if ($_GET['status'] == 0) { ?>active<?php } ?>"><a href="admin/question/report_list/"><?php _e('新举报'); ?></a></li>
					<li class="<?php if ($_GET['status'] == 1) { ?>active<?php } ?>"><a href="admin/question/report_list/status-1"><?php _e('已处理'); ?></a></li>
					<li class="<?php if ($_GET['status'] == 2) { ?>active<?php } ?>"><a href="admin/question/report_list/status-2"><?php _e('拒绝处理'); ?></a></li>
				</ul>
            </h3>
        </div>

		<div class="mod-body tab-content">
			<form action="admin/ajax/report_manage/" id="batchs_form" onsubmit="return false;" method="post">
			<input name="action_type" id="action_type" type="hidden" value="" />
			<div class="table-responsive">
			<?php if ($this->list) { ?>
				<table class="table table-striped">
					<thead>
						<tr>
							<th><input type="checkbox" class="check-all"></th>
							<th><?php _e('地址'); ?></th>
							<th><?php _e('理由'); ?></th>
							<th><?php _e('时间'); ?></th>
							<th><?php _e('举报人'); ?></th>
							<?php if($_GET['status']==2){?>
							<th><?php _e('拒绝理由'); ?></th>
							<?php } ?>
							<th><?php _e('操作'); ?></th>
						</tr>
					</thead>
					<tbody>
						<?php foreach ($this->list AS $key => $val) { ?>
							<tr>
								<td><input name="report_ids[]" value="<?php echo $val['id']; ?>" type="checkbox" /></td>
								<td><a href="<?php echo $val['url']; ?>" target="_blank"><?php echo $val['url']; ?></a></td>
								<td><?php echo nl2br($val['reason']); ?></td>
								<td><?php echo date_friendly($val['add_time']); ?></td>
								<td><a href="people/<?php echo $val['user']['uid']; ?>" target="_blank"><?php echo $val['user']['user_name']; ?></a></td>
								<?php if($_GET['status']==2){?>
								<td><?php echo nl2br($val['decline_reason']); ?></td>
								<?php } ?>
								<td align="center">
									<?php if ($_GET['status'] == 1) { ?>
									<i title="<?php _e('已处理'); ?>" class="icon icon-followed md-tip"></i>
									<?php } elseif($_GET['status'] == 2) { ?>
									<i title="<?php _e('已拒绝'); ?>" class="icon icon-followed md-tip"></i>
									<?php }else{ ?>
									<a onclick="AWS.ajax_request(G_BASE_URL + '/admin/ajax/report_manage/', 'action_type=handle&report_ids[]=<?php echo $val['id']; ?>')" data-toggle="tooltip" title="<?php _e('标记为已处理'); ?>" class="icon icon-check md-tip"></a>
									<a onclick="decline(<?php echo $val['id']; ?>)" data-toggle="tooltip" title="<?php _e('标记为拒绝处理'); ?>" class="icon icon-forbid md-tip"></a>
									<?php } ?>
								</td>
							</tr>
						<?php } ?>
					</tbody>
				</table>
			<?php } ?>
			</div>
			</form>
			<div class="mod-table-foot">
				<span class="pull-right mod-page"><?php echo $this->pagination; ?></span>
				<a onclick="$('#action_type').val('delete'); AWS.ajax_post($('#batchs_form'));" class="btn-danger btn"><?php _e('删除'); ?></a>
				<?php if ($_GET['status'] == 0) { ?><a onclick="$('#action_type').val('handle'); AWS.ajax_post($('#batchs_form'));" class="btn-primary btn"><?php _e('标记'); ?></a><?php } ?>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript" src="<?php echo G_STATIC_URL; ?>/js/layer/layer.js"></script>
<script>
	//拒绝理由
	function decline(id){
		var url = G_BASE_URL + '/admin/ajax/report_manage/';
		layer.prompt({title: '请输入拒绝理由', formType: 2}, function(text, index){
			layer.close(index);
			AWS.ajax_request(url,'action_type=decline&report_ids='+id+'&reason='+text);
		});
	}
</script>
<?php TPL::output('admin/global/footer.tpl.htm'); ?>